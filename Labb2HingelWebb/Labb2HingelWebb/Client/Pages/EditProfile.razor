@page "/EditProfile"
@using Labb2HingelWebb.Shared.DTOs

@inject HttpClient HttpClient
@inject AuthenticationStateProvider AuthenticationStateProvider

<h3>EditProfile</h3>

<div class="container">
	<EditForm Model="ActiveCustomerDto" OnSubmit="UpdateUser">
	<div class="form-control">
			<label>Name</label>
			<InputText @bind-Value="ActiveCustomerDto.UserName"></InputText>
			<label>Address</label>
			<InputText @bind-Value="ActiveCustomerDto.Address"></InputText>
			<label>Phone</label>
			<InputText @bind-Value="ActiveCustomerDto.Phone"></InputText>
		</div>
		<button class="btn btn-primary">Send</button>
	
	</EditForm>
</div>




@code {
	CustomerDto? ActiveCustomerDto { get; set; } = new();

	protected override async Task OnInitializedAsync()
	{
		var userInfo = await AuthenticationStateProvider.GetAuthenticationStateAsync();

		var userName = userInfo.User.Identity.Name;

		var response = await HttpClient.GetFromJsonAsync<CustomerDto>(HttpClient.BaseAddress + $"findUserByName/{userName}");

		if (response != null)
		{
			ActiveCustomerDto = response;
		}

		await base.OnInitializedAsync();
	}


	private async Task UpdateUser()
	{
		var response = await HttpClient.PostAsJsonAsync<CustomerDto>(HttpClient.BaseAddress + "updateUser", ActiveCustomerDto);
	}

}